#!/usr/bin/zsh
############################################################################################
# Gonzalo Peci

export ZPLUG_HOME="${HOME}/.zplug"
ZSH_COMPDUMP="$ZPLUG_HOME/zcompdump"

# Check if zplug is installed
if [[ ! -f ~/.zplug/init.zsh ]]; then
    git clone https://github.com/b4b4r07/zplug ~/.zplug
    source ~/.zplug/init.zsh
else
    # Load ZPLUG
    source ~/.zplug/init.zsh
fi

# Add zplug plugins
#zplug 'zplug/zplug', hook-build:'zplug --self-manage'

# OMZ Libs
zplug "lib/functions", from:oh-my-zsh, defer:0
zplug "lib/misc", from:oh-my-zsh, defer:0
zplug "lib/key-bindings", from:oh-my-zsh
zplug "lib/history", from:oh-my-zsh
zplug "lib/grep", from:oh-my-zsh
zplug "lib/clipboard", from:oh-my-zsh
zplug "lib/theme-and-appearance", from:oh-my-zsh

# Basic utils
zplug "plugins/common-aliases", from:oh-my-zsh
zplug "plugins/sudo", from:oh-my-zsh
zplug "plugins/rsync", from:oh-my-zsh
zplug "plugins/tmux", from:oh-my-zsh
zplug "plugins/urltools", from:oh-my-zsh
zplug "plugins/z", from:oh-my-zsh, defer:2
zplug "rimraf/k", from:github
zplug "Russell91/sshrc", from:github, as:command, use:"sshrc"
zplug "djui/alias-tips"

# Git
zplug "plugins/git", from:oh-my-zsh, defer:2

# Ruby
zplug "plugins/chruby", from:oh-my-zsh, defer:2
zplug "plugins/bundler", from:oh-my-zsh, defer:2

# Python
zplug "plugins/python", from:oh-my-zsh, defer:2
zplug "plugins/pip", from:oh-my-zsh, defer:2

# GoLang
zplug "plugins/golang", from:oh-my-zsh, defer:2

# Containers/Virtual
zplug "plugins/vagrant", from:oh-my-zsh, if:"which vagrant", defer:2
zplug "plugins/docker-compose", from:oh-my-zsh, if:"which docker-compose", defer:2

# Hashicorp
zplug "plugins/terraform", from:oh-my-zsh, defer:2

# AWS
zplug "plugins/aws", from:oh-my-zsh, defer:2

# Terraform
zplug "kamatama41/tfenv", as:command, use:"bin/*"

# Coya
zplug "$HOME/Workspace/Coya/src/ragbag/coya-vars", from:local
zplug "$HOME/Workspace/Coya/src/ragbag/travis-vars", from:local
zplug "$HOME/Workspace/src/autotfenv", from:local, use:"bin/autoload.sh"

# Misc
# zsh-syntax-highlighting must be loaded after executing compinit command and sourcing other plugins
zplug "zsh-users/zsh-syntax-highlighting", defer:3
zplug "zsh-users/zsh-history-substring-search", defer:3
zplug "zsh-users/zsh-autosuggestions", defer:3
zplug "RobSis/zsh-completion-generator", defer:1

# Set Theme
zplug "denysdovhan/spaceship-prompt", use:spaceship.zsh, from:github, as:theme

# And load
# Install plugins if there are plugins that have not been installed
if ! zplug check; then
    printf "Install plugins? [y/N] "
    if read -q; then
        echo
        zplug install
    else
        echo
    fi
fi

# Then, source plugins and add commands to $PATH
zplug load # --verbose
